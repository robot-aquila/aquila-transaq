Тест Кейсы интеграционных тестов


Symbol Data Service

===============================================================================
SDS001
Descr: Первичная подписка на L1_BBO; подключено; символ существует;
quotations отсутствует

* Given
1) Базовая информация об инструменте загружена
2) Подключение установлено

* When
1) Поступил запрос на подписку L1_BBO на символ

* Then
1) Первичные атрибуты на базе параметров инструмента и параметров торгов
инструмента сформированы
2) Подписан на фид L1_BBO
3) Поступает перичный ответ по фиду quotations, на основании которых
формируются BBO, OHLC

===============================================================================
SDS002
Descr: Вторичная подписка на L1_BBO; подключено; символ существует;
quotations в наличии от предыдущей работы

* Given
1) Базовая информация об инструменте загружена
2) Информация о котировках загружена
3) Подключение установлено

* When
1) Поступил запрос на подписку L1_BBO на символ

* Then
1) Первичные атрибуты на базе параметров инструмента и параметров торгов
инструмента сформированы
2) На базе текущего quotations сформированы BBO 

===============================================================================
SDS003
Descr: Подписка на фиды после установки соединения

* Given
1) Базовая информация об инструментах загружена
2) Оформлены подписки L1 на RTS-3.20, L2 на GAZP, L1_BBO на Si-3.20

* When
1) Запуск терминала и подключение к удаленному серверу

* Then
1) Подключение установлено
2) Оформляются подписки на фиды:
    quotations: RTS-3.20, GAZP, Si-3.20
    alltrades: RTS-3.20, GAZP
    quotes: GAZP

===============================================================================
SDS004
Descr: Корректная подача бид/аск обновлений L1 BBO без дублей

* Given
1) Базовая информация об инструментах загружена
2) Подключение установлено
3) Оформлена подписка на L1_BBO RTS-3.20

* When
1) Поступают обновления quotations для RTS-3.20

* Then
1) Для каждого апдейта quotations генерится бид/аск только при условии
   изменения значений соответствующих атрибутов


===============================================================================
SDS005
Descr: Обновления атрибутов группы OHLC при поступлении quotations

* Given:
1) Базовая информация об инструментах загружена
2) Подключение установлено
3) Оформлена подписка на L1_BBO RTS-3.20

* When
1) Поступают обновления quotations для RTS-3.20

* Then
1) При изменении OHLC генерятся соответствующие апдейты инструмента

===============================================================================
SDS006
Descr: Отписка последнего подписчика при наличи подключения приводит к отписке
от соответствующих фидов

* Given:
1) Базовая информация об инструментах загружена
2) Подключение установлено
3) Оформлена подписка на L1_BBO RTS-3.20
4) Оформлена подписка на L2 RTS-3.20


* When
1) Отказ от подписки на L1_BBO TS-3.20
2) Отказ от подписки на L2 RTS-3.20

* Then
1) Отписка от фида quotations RTS-3.20


===============================================================================
SDS007
Descr: Отписка последнего подписчика при отсутствии подключения не приводит
к отправке каких-либо команд

* Given:
1) Базовая информация об инструментах загружена
2) Подключение установлено
3) Оформлена подписка на L1_BBO RTS-3.20
4) Оформлена подписка на L1 RTS-3.20
5) Соединение потеряно

* When
1) Отказ от подписки на L1 RTS-3.20
2) Отказ от подписки на L1_BBO TS-3.20

* Then
1) Никаких команд в удаленную систему не передано

===============================================================================
SDS008
Descr: При установлении подключения все предыдущие подписки отменяются, а по
текущим закешированным запросам выполняется подписка на соответствующие фиды.

* Given
1) Базовая информация об инструментах загружена
2) Соединение установлено
3) Оформлена подписка на L1 Si-3.20
4) Оформлена подписка на L2 RTS-3.20
5) Соединение потеряно
6) Отменена подписка на L2 RTS-3.20

* When
1) Соединение восстановлено

* Then
1) Подписка на фиды alltrades и quotations для Si-3.20

===============================================================================
SDS009
Descr: Подписка на несуществующий инструмент (несуществующая борда, баг #2639).

* Given
1) Базовая информация об инструментах загружена
2) Соединение установлено

* When
1) Подан запрос на подписку GAZP@EQTB

* Then
1) Исключений и ошибок нет

===============================================================================
SDS010
Descr: Подавление обработки сообщений после закрытия терминала

Если обновления поступают после закрытия терминала, то исключения при
вызове методов терминала, засирают лог (поскольку терминал закрыт). Как
протестить - непонятно. Сформулировать можно так - после закрытия терминала
никакие сообщения не обрабатываются и в терминал не пихаются.

Проблема вылезает потому, что дата провайдер закрывается после того, как
для терминала установлен closed. Все сообщения, которые поступили меду вызовом
close терминала и вызовом close дата провайдера попадают на закрытый терминал.
Решение здесь простое - исправить в терминале момент закрытия датапровайдера.
Датапровайдер должен закрываться перед установкой closed терминала.
Другой вопрос, как сэмулировать проблему в тесте?

Гарантированно подать сообщения после вызова close терминала, но до вызова
close датапровайдера можно переопределив close провайдера и заполнив очередь
до вызова оригинального close провайдера.

* Given
1) Базовая информация об инструментах загружена
2) Оформлена подписка на GAZP@TQBR
3) Соединение установлено

* When
1) Между началом закрытия терминала и фактическим закрытием провайдера приходят
сообщения с удаленного сервера

* Then
1) Сообщения обрабатываются нормальным образом не вызывая никаких ошибок


===============================================================================
SDS011
Descr: Обработка информации о сделках

* Given
1) Базовая информация об инструментах загружена
2) Оформлена подписка на L1 RTS-2.30
3) Соединение установлено

* When
1) Поступают данные о сделках

* Then
2) Обновляется Last Trade инструмента и генерируютс соответствующие события

===============================================================================

TODO:

* При разрыве соединения, каждый стакан переводится в состояние перестройки при
котором следующий апдейт будет рассматриваться как снепшот (стакан сначала будет
очищен, а затем к нему будет применен апдейт).


